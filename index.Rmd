---
title: "Gov 50 Final Project"
author: "Amber Nolazco-Torres"
description: "My final project"
output:
  distill::distill_article:
    self_contained: false
---


```{r}
library(tidyverse)
library(gapminder)
schools <- read_csv("crdc-2015-16-ca-aug-2018.csv")
schools
```

```{r}
subset <- schools  %>% 
  filter(SCH_GRADE_G09 == "YES" & SCH_GRADE_G10 == "YES" & SCH_GRADE_G11 == "YES" & SCH_GRADE_G12 == "YES" &    SCH_GRADE_G08 == "NO") 

subset[subset < 0] <- NA 
  
median(subset$SCH_APCOURSES, na.rm = TRUE) 

```

## Hispanic Students
```{r}
## schools[schools == -9] <- NA

subset <- subset |> 
  filter(!is.na(SCH_APENR_HI_M) & !is.na(SCH_APENR_HI_F)) |> 
  mutate(total_hispanic_students_AP = (SCH_APENR_HI_M + SCH_APENR_HI_F),
         total_hispanic_student_enrollment = (SCH_ENR_HI_M + SCH_ENR_HI_F)) |> 
  mutate(school_level_hisp_m_AP_rate = total_hispanic_students_AP/total_hispanic_student_enrollment)
 

subset_hispanic <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_hisp_m_AP_rate, na.rm = TRUE)) |>
  ggplot(mapping = aes(x = AP_distribution, y = Proportion_APClasses )) +
  geom_col() +
  labs(x = "Number of AP Classes Offered (CA Public High Schools)",
       y = "Proportion of Hispanic Students in at least 1 AP Class",
       title = "California: Proportion of Hispanic Students in at least 1 AP Class")
subset_hispanic

subset_groups_H <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_hisp_m_AP_rate, na.rm = TRUE)) |> 
  pivot_wider(names_from = AP_distribution, values_from = Proportion_APClasses) |> 
  mutate(ATE = `Schools with 12 or more AP Classes` - `Schools with less than 12 AP Classes`)

subset_groups_H

```

## Asian Students 
```{r}
subset <- subset |> 
  filter(!is.na(SCH_APENR_AS_M) & !is.na(SCH_APENR_AS_F)) |> 
  mutate(total_asian_students_AP = (SCH_APEXAM_ONEORMORE_AS_M + SCH_APENR_AS_F),
         total_asian_student_enrollment = (SCH_ENR_AS_M + SCH_ENR_AS_F)) |> 
  mutate(school_level_asian_m_AP_rate = total_asian_students_AP/total_asian_student_enrollment)
 

subset_asian <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_asian_m_AP_rate, na.rm = TRUE)) |>
  ggplot(mapping = aes(x = AP_distribution, y = Proportion_APClasses )) +
  geom_col() +
  labs(x = "Number of AP Classes Offered (CA Public High Schools)",
       y = "Proportion of Asian Students in at least 1 AP Class",
       title = "California: Proportion of Asian Students in at least 1 AP Class")
subset_asian

subset_groups_A <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_asian_m_AP_rate, na.rm = TRUE)) |> 
  pivot_wider(names_from = AP_distribution, values_from = Proportion_APClasses) |> 
  mutate(ATE = `Schools with 12 or more AP Classes` - `Schools with less than 12 AP Classes`)

subset_groups_A
```

## American Indian/Alaska Native Students
```{r}
subset <- subset |> 
  filter(!is.na(SCH_APENR_AM_M) & !is.na(SCH_APENR_AM_F)) |> 
  mutate(total_native_students_AP = (SCH_APENR_AM_M + SCH_APENR_AM_F),
         total_native_student_enrollment = (SCH_ENR_AM_M + SCH_ENR_AM_F)) |> 
  mutate(school_level_native_m_AP_rate = total_native_students_AP/total_native_student_enrollment)
 

subset_native <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_native_m_AP_rate, na.rm = TRUE)) |>
  ggplot(mapping = aes(x = AP_distribution, y = Proportion_APClasses )) +
  geom_col() +
  labs(x = "Number of AP Classes Offered (CA Public High Schools)",
       y = "Proportion of Native Students in at least 1 AP Class",
       title = "California: Proportion of Native Students in at least 1 AP Class")
subset_native

subset_groups_N <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_native_m_AP_rate, na.rm = TRUE)) |> 
  pivot_wider(names_from = AP_distribution, values_from = Proportion_APClasses) |> 
  mutate(ATE = `Schools with 12 or more AP Classes` - `Schools with less than 12 AP Classes`)

subset_groups_N
```

## Native Hawaiian/Pacific Islander Students 
```{r}
subset <- subset |> 
  filter(!is.na(SCH_APENR_HP_M) & !is.na(SCH_APENR_HP_F)) |> 
  mutate(total_nativepacific_students_AP = (SCH_APENR_HP_M + SCH_APENR_HP_F),
         total_nativepacific_student_enrollment = (SCH_ENR_HP_M + SCH_ENR_HP_F)) |> 
  mutate(school_level_nativepacific_m_AP_rate = total_nativepacific_students_AP/total_nativepacific_student_enrollment)
 

subset_nativepacific <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_nativepacific_m_AP_rate, na.rm = TRUE)) |>
  ggplot(mapping = aes(x = AP_distribution, y = Proportion_APClasses )) +
  geom_col() +
  labs(x = "Number of AP Classes Offered (CA Public High Schools)",
       y = "Proportion of Native Hawaiian/Pacific Islander Students in at least 1 AP Class",
       title = "California: Proportion of Native Hawaiian/Pacific Islander Students in at least 1 AP Class")

subset_nativepacific

subset_groups_NP <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_nativepacific_m_AP_rate, na.rm = TRUE)) |> 
  pivot_wider(names_from = AP_distribution, values_from = Proportion_APClasses) |> 
  mutate(ATE = `Schools with 12 or more AP Classes` - `Schools with less than 12 AP Classes`)

subset_groups_NP
```

## Black Students 
```{r}
subset <- subset |> 
  filter(!is.na(SCH_APENR_BL_M) & !is.na(SCH_APENR_BL_F)) |> 
  mutate(total_black_students_AP = (SCH_APENR_BL_M + SCH_APENR_BL_F),
         total_black_student_enrollment = (SCH_ENR_BL_M + SCH_ENR_BL_F)) |> 
  mutate(school_level_black_m_AP_rate = total_black_students_AP/total_black_student_enrollment)
 

subset_black <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_black_m_AP_rate, na.rm = TRUE)) |>
  ggplot(mapping = aes(x = AP_distribution, y = Proportion_APClasses )) +
  geom_col() +
  labs(x = "Number of AP Classes Offered (CA Public High Schools)",
       y = "Proportion of Black Students in at least 1 AP Class",
       title = "California: Proportion of Black Students in at least 1 AP Class")
subset_black

subset_groups_B <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_black_m_AP_rate, na.rm = TRUE)) |> 
  pivot_wider(names_from = AP_distribution, values_from = Proportion_APClasses) |> 
  mutate(ATE = `Schools with 12 or more AP Classes` - `Schools with less than 12 AP Classes`)

subset_groups_B
```

## White students 
```{r}
subset <- subset |> 
  filter(!is.na(SCH_APENR_WH_M) & !is.na(SCH_APENR_WH_M)) |> 
  mutate(total_white_students_AP = (SCH_APENR_WH_M + SCH_APENR_WH_M),
         total_white_student_enrollment = (SCH_ENR_WH_M + SCH_ENR_WH_F)) |> 
  mutate(school_level_white_m_AP_rate = total_white_students_AP/total_white_student_enrollment)
 

subset_white <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_white_m_AP_rate, na.rm = TRUE)) |>
  ggplot(mapping = aes(x = AP_distribution, y = Proportion_APClasses )) +
  geom_col() +
  labs(x = "Number of AP Classes Offered (CA Public High Schools)",
       y = "Proportion of White Students in at least 1 AP Class",
       title = "California: Proportion of White Students in at least 1 AP Class")
subset_white

subset_groups_W <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_white_m_AP_rate, na.rm = TRUE)) |> 
  pivot_wider(names_from = AP_distribution, values_from = Proportion_APClasses) |> 
  mutate(ATE = `Schools with 12 or more AP Classes` - `Schools with less than 12 AP Classes`) +


subset_groups_W
```

## Two or More Race Students 
```{r}
subset <- subset |> 
  filter(!is.na(SCH_APENR_TR_M) & !is.na(SCH_APENR_TR_F)) |> 
  mutate(total_mixedrace_students_AP = (SCH_APENR_TR_M + SCH_APENR_TR_F),
         total_mixedrace_student_enrollment = (SCH_ENR_TR_M + SCH_ENR_TR_F)) |> 
  mutate(school_level_mixedrace_m_AP_rate = total_mixedrace_students_AP/total_mixedrace_student_enrollment)
 

subset_mixedrace <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_mixedrace_m_AP_rate, na.rm = TRUE)) |>
  ggplot(mapping = aes(x = AP_distribution, y = Proportion_APClasses )) +
  geom_col() +
  labs(x = "Number of AP Classes Offered (CA Public High Schools)",
       y = "Proportion of Two or More Race Students in at least 1 AP Class",
       title = "California: Proportion of Two or More Race Students in at least 1 AP Class")
subset_mixedrace

subset_groups_MR <- subset |>
  mutate(
    AP_distribution = case_when(
      SCH_APCOURSES >= 12 ~ "Schools with 12 or more AP Classes", 
      SCH_APCOURSES < 12 & SCH_APCOURSES != 0 ~ "Schools with less than 12 AP Classes", 
      is.na(SCH_APCOURSES) ~ "No AP Classes")) |>
  group_by(AP_distribution) %>% 
  summarize(Proportion_APClasses = mean(school_level_mixedrace_m_AP_rate, na.rm = TRUE)) |> 
  pivot_wider(names_from = AP_distribution, values_from = Proportion_APClasses) |> 
  mutate(ATE = `Schools with 12 or more AP Classes` - `Schools with less than 12 AP Classes`)

subset_groups_MR
```

## Final Project

## Introduction:Are Hispanic students in California prepared for college-level courses?  Due to the education gap, I hypothesize that Hispanic students in California are taking fewer Advanced Placement courses compared to other racial groups. It is critical to monitor the disparities among racial groups in AP course enrollment to identify populations in need of more support. In order to create an equitable education system where students are college-ready, we must ensure all students are enrolled in AP courses. In my project, I also analyze how the average district income impacts students' likelihood of being enrolled in AP courses. 

## Data: My project is a cross-sectional study where I analyze survey data from the U.S. Census Bureau and the Office for Civil Rights. I use data from the OCR Civil Rights Data Collection from 2015-2016 that contains information on every school district in California. This information is collected directly from the school districts. From this data, I obtained my dependent variable, which is the proportion of students by racial group enrolled in AP courses in every school district in California. I also use data from the U.S. Census Bureau American Community Survey – Education Tabulation (ACS-ED) from 2010-2014. This is an annual national survey conducted by the U.S. Census Bureau to obtain information on communities. From this data, I obtained my independent variable, which is the average household income for every school district in California

##In my first two plots, I have the proportion of students enrolled in at least one AP course by racial groups. I created a plot for students attending schools with 12 or more AP courses, and another for students attending schools with less than 12 AP classes. Twelve was the average number of AP classes offered by high schools in the dataset. I separated these two groups to account for possible income differences that might impact the number of AP courses offered at a school district. 

```{r}
library(ggplot2)
library(dplyr)

H_Average <- subset_groups_H |>
  select("Schools with 12 or more AP Classes","Schools with less than 12 AP Classes")

A_Average <- subset_groups_A |>
  select("Schools with 12 or more AP Classes","Schools with less than 12 AP Classes")

N_Average <- subset_groups_N |>
  select("Schools with 12 or more AP Classes","Schools with less than 12 AP Classes")

NP_Average <- subset_groups_NP |>
  select("Schools with 12 or more AP Classes","Schools with less than 12 AP Classes")

B_Average <- subset_groups_B |>
  select("Schools with 12 or more AP Classes","Schools with less than 12 AP Classes")

W_Average <- subset_groups_W |>
  select("Schools with 12 or more AP Classes","Schools with less than 12 AP Classes")

MR_Average <- subset_groups_MR |>
  select("Schools with 12 or more AP Classes","Schools with less than 12 AP Classes")

Race_1 <- c("Hispanic", "Asian", "American Native", "Pacific Islander", "Black", "White", "Two or More Races")

Average_Races <- rbind(H_Average, A_Average, N_Average, NP_Average, B_Average, W_Average, MR_Average)

AP_Averages_Race <- data.frame(race = Race_1, averages = Average_Races*100) 


AP_Averages_Race |>
  group_by(race) |>
  ggplot(aes(x = race, y = averages.Schools.with.12.or.more.AP.Classes)) +
  geom_col() +
    labs(x = "Race",
       y = "Percent of Students in at Least 1 AP Class",
       title = "California: Proportion of Students by Racial Group in at least 1 AP Class",
       subtitle = "Schools with 12 or more AP Classes",
       source = "Office for Civil Rights") +
  geom_text(aes(label = averages.Schools.with.12.or.more.AP.Classes), vjust = -0.5, color = "blue", size = 3)


AP_Averages_Race |>
  group_by(race) |>
  ggplot(aes(x = race, y = averages.Schools.with.less.than.12.AP.Classes)) +
  geom_col() +
  labs(x = "Race",
       y = "Percent of Students in at Least 1 AP Class",
       title = "California: Proportion of Students by Racial Group in at least 1 AP Class",
       subtitle = "Schools with less than 12 AP Classes",
       source = "Office for Civil Rights") +
  geom_text(aes(label = averages.Schools.with.less.than.12.AP.Classes), vjust = -0.5, color = "blue", size = 3)

knitr::kable(AP_Averages_Race)
```

```{r}
income <- read_csv("Average Income.csv", col_names = FALSE)

income
```

```{r}
income <- income |>
  mutate(X2 = str_extract(X2,"^[^/]+") |> str_to_upper())
```

```{r}
income <- income |>
  mutate(X3 = str_trim(str_replace(X2, " SCHOOL DISTRICT", "")))

```

```{r}
merged_data <- inner_join(subset, income, by = c("LEA_NAME" = "X3"))
```

```{r}
merged_data <- merged_data |>
  mutate(X1_numeric = as.numeric(str_replace_all(X1, "[$,]", "")))
```

```{r}
R1  <- lm(school_level_hisp_m_AP_rate ~ X1_numeric, data = merged_data)

outcome_variable_R1 <- coef(R1)[2]

summary(R1)
```

```{r}
R2 <- lm(school_level_asian_m_AP_rate ~ X1_numeric, data = merged_data)

outcome_variable_R2 <- coef(R2)[2]

summary(R2)
```

```{r}
R3  <- lm(school_level_native_m_AP_rate ~ X1_numeric, data = merged_data)

outcome_variable_R3 <- coef(R3)[2]

summary(R3)
```

```{r}
R4  <- lm(school_level_nativepacific_m_AP_rate ~ X1_numeric, data = merged_data)

outcome_variable_R4 <- coef(R4)[2]

summary(R4)
```

```{r}
R5  <- lm(school_level_black_m_AP_rate ~ X1_numeric, data = merged_data)

outcome_variable_R5 <- coef(R5)[2]

summary(R5)
```

```{r}
R6  <- lm(school_level_white_m_AP_rate ~ X1_numeric, data = merged_data)

outcome_variable_R6 <- coef(R6)[2]

summary(R6)
```

```{r}
R7  <- lm(school_level_mixedrace_m_AP_rate ~ X1_numeric, data = merged_data)

outcome_variable_R7 <- coef(R7)[2]

summary(R7)
```
##Results: In my bar plot, I showcase my regression of interest, which is the impact of the average household income of a school district in California on the likelihood of a student being enrolled in at least one AP course. My bar chart divides students into racial groups and displays the estimated probability of a student from each group enrolling in at least one AP course for every $100,000 increase in the school district's average household income. 

##The bar plot demonstrates that Hispanic students are impacted the least by a $100,000 increase in the school district's average household income. For every $100,000 increase, Hispanic students are only 1.5% more likely to be enrolled in at least one AP course. This coefficient demonstrates that Hispanic students are still less likely to be enrolled in AP courses, even with an increase in the average household income in their school district. The statistical significance is likely for the estimated coefficients because all but one of the regressions for the racial groups had a P value less than 0.05. The Pacific Islander regression had a P value of 0.1846. My analysis also contains information from 823 high schools out of the 1018 high schools in the original dataset from the OCR Civil Rights Data Collection. I do not believe the coefficients represent a causal effect because various possible confounding variables must be accounted for. 

##Conclusion: In my first plots, I summarize the proportion of students by racial group enrolled in at least one AP course in California. I created a plot for students attending schools with 12 or more AP courses, and another for students attending schools with less than 12 AP classes. In both plots, Black and Hispanic students are the racial group with the lowest number of students enrolled in AP courses. In my regressions, I found that Hispanic students were the racial group least impacted by a $100,000 increase in the school district's average household income. This implies that Hispanic students are still less likely to be enrolled in AP courses, even with an increase in the average household income in their school district. The results from my analysis can all be used as evidence to prove my hypothesis that Hispanic students are less likely to be enrolled in AP courses in comparison to other racial groups. There are various possible confounding variables in my analysis. In the OCR Civil Rights Data Collection from 2015-2016, there is a large amount of missing data that may have interfered with my analysis. It is possible that school districts with positive data to report were more incentivized to report their numbers to the Office for Civil Rights. It is also important to note that the data from the U.S. Census Bureau only reported the average household income of whole school districts and not individual racial groups. This limitation barred me from analyzing the impact of a $100,000 average household income increase for each racial group within a California school district. With more time and resources, I would improve my analysis by getting data on the average household income for each racial group within each school district. 


```{r}
library(ggplot2)
race <- c("Hispanic", "Asian", "American Native", "Pacific Islander", "Black", "White", "Two or More Races")

coef_values <- c(outcome_variable_R1,outcome_variable_R2,outcome_variable_R3,outcome_variable_R4,outcome_variable_R5,outcome_variable_R6,outcome_variable_R7)

coefficients <- data.frame(race = race, coefs = coef_values) |>
  mutate(percent_coefs = coefs*10000000)

coefficients |>
  group_by(race) |>
  ggplot(mapping = aes(x = race, y = percent_coefs)) +
  geom_col() +
  labs(x = "Race",
       y = "Percent of Students in at Least 1 AP Class",
       title = "California: Proportion of Students by Racial Group in at least 1 AP Class",
       subtitle = "For Every $100,000 Average Distrcit Income Increase",
       source = "Office for Civil Rights and The U.S. Census Bureau") +
  geom_text(aes(label = percent_coefs), vjust = -0.5, color = "blue", size = 3)

knitr::kable(coefficients)
```









